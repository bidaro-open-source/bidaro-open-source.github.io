# Инфраструктура

Под инфраструктурой понимается все компоненты и технологии, необходимые для разработки, развертывания и поддержки продукта в продакшен окружении.

## Сервер

Под сервером понимается кластер серверов под управлением kubernetes. Из вне, через IP-адресс, приходит запрос и попадает на ingress узел с load балансером, который далее определяет узел для обработки запроса и перенаправляет его туда.

Каждый узел кластера имеет поднятный контейнер с основным приложением.

Так же выделятся ряд узлов для основных хранилищ продукта.

## Основное приложение

Основное приложение продукта, с которым взаимодействуют пользователи, написано на фреймворке Nuxt 3 и совмещает в себе Frontend и Backend части.

Пользовательская часть приложения посылает все запросы на серверную часть.

Серверная часть приложения подключается ко внешним сервисам (основные хранилища, smtp сервер и т.д), принимает запросы от пользователей и производит необходимые манипуляции с данными (чтение, добавление, переадресацию и т.д.) при этом не сохраняя никакого состояния внутри себя.

## Основные хранилища

Для сохранения данных продукта (пользователи, лоты, токены, изображения и т.д.) используются специализированные хранилища запущеные в кластере kubernetes.

- Для сохранения временных или часто используемых данных будет использоваться Redis как хранилище кеша.

- Для сохранения всех остальных данных будет использоваться PostgreSQL как основная база данных.

- Для сохранения резервных копий данных приложения будет использоваться отдельное внешнее файловое хранилище Google Drive.

## DevOps и CI/CD

Когда выходит новая версия основного приложения, запускаются процессы поставки новой версии на сервер в GitHub Actions.

Что происходит на сервере:

- Сервер переводится в maintenance режим. Все внешние запросы будут переводится на приложение с выдачей информации о техническом обслуживании продукта.

- Удаляются все работающие экземпляры основного приложения.

- Запускается процесс обновления контейнеров основного приложения и приложения для миграции.

- Запускается обновленное приложения для миграции базы данных.

- Запускаются экземпляры основного приложения.

- Сервер переводится в рабочий режим.

## Внешние интеграции

### Сетевые компоненты

Все, без исключения, пользователи будут взаимодействовать с продуктом через доменное имя (DNS, например auction.ua.com). Оно переводит пользователя по нашему IP адресу, где его принимает наш сервер.

### Безопасность сети

При создании соединения между пользователем и сервером, будет производится обмен SSL/TLS сертификатами от Let's Encrypt, которые будут шифровать передачу логинов, паролей и других важных данный.

### Внешнее хранилище

- Для сохранения полноценных файлов и изображений будет использоваться S3-совместимое объектное хранилище.

### Внешние сервисы

- Для произведения оплаты услуг пользователем, будет использоватся платежный сервис Fondy.

- Для отправки рассылки пользователям, будет использоваться email провайдер Gmail.
