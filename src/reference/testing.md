# Тестирование

Чтобы удостоверится в правильной работе продукта, в основные моменты изменения кода будет проходит его тестирование. Это поможет отловить баги и проблемы на ранних этапах и оперативно их исправить.

Когда происходит тестирование:

- При внесении изменений в исходный код. Запускаются unit и integration тесты на стороне разработчика, чтобы не допустить мелких ошибок с его стороны.

- При создании запроса на слитие кода в develop ветку. Запускаются все виды тестов на стороне GitHub Actions.

Таким образом достигается состояния, когда код из develop ветки может в любой момент выйти в релиз, так как все изменения прошли полное тестирование.

## Виды тестов

### Unit-тесты

Чтобы протестировать маленькие части приложения, например composables фукнции, утилиты, хранилища и другое, используется unit тесты.

Они выполняются очень быстро и это позволяет убедится в том, что функции которые могут быть на всех уровнях приложения работают без ошибок.

### Integration-тесты

Чтобы протестировать компоненты с которыми взаимодействует пользователь, например формы, используется интеграционные (или компонентные) тесты.

### End-to-End тесты

Задачей e2e тестов является протестировать основной поток пользователя, чтобы убедится что там нет ошибок.

Например, что аутентификация с правильными данными работает так, как задуманно и пользователь попадает попадет в свой профиль.

### End-to-End API тесты

Задачей e2e тестов для API является проверка того, что запросы на серверную часть ожидаемо правильно обрабатываются.

Например, что запрос на получение данных без токена возвращает ошибку, или запрос на вход в профиль с правильными данными возвращает успех.

## Запуск тестов локально

Когда разработчик запускает тесты на своем компютере, с unit и integration тестами проблем не возникает, так как они не выходят за рамки приложения, а все внешние запросы подменяются. А вот для e2e тестов внешние сервисы уже необходимы.

Чтобы запустить такие тесты, на стороне разработчика нужно:

- Поднять все внешние сервисы через docker

- Создать копию `.env` с названием `.env.test`

- Сделать миграцию базы данных через migrator

После всех этих манипуляций, e2e тесты запустятся

::: warning Важно!
В `.env.test` адреса сервисов могут быть равны с `.env`, но названия базы данных или бакета s3 хранилища должны быть разными. Перед началом тестирования происходит полное удаление всех данных, чтобы ничего не мешало отслеживать эффекты от запуса тестов.
:::

## Запуск тестов через CI/CD

Если запуск тестов локально требует вручную поднять docker контейнеры приложения, то через GitHub Actions достаточно будет [прописать сервисы в workflow файле](https://docs.github.com/en/actions/using-containerized-services/about-service-containers).
